if (self.CavalryLogger) { CavalryLogger.start_js(["fHANF"]); }

__d("Keyframes",["Promise","Bootloader","Deferred","NavigationMetrics","XHRRequest"],(function a(b,c,d,e,f,g){"use strict";var h={},i=new(c("Deferred"))();c("NavigationMetrics").addRetroactiveListener(c("NavigationMetrics").Events.EVENT_OCCURRED,function(u,v){var event=v.event;if(event==="all_pagelets_displayed")i.resolve()});function j(){return i.then(function(){return new(c("Promise"))(function(u){c("Bootloader").loadModules(["KeyframesRenderer"],function(v){return u(v)},"Keyframes")})})}function k(){return i.then(function(){return new(c("Promise"))(function(u){c("Bootloader").loadModules(["FBKeyframesLoggedSession"],function(v){return u(v)},"Keyframes")})})}function l(){return i.then(function(){return new(c("Promise"))(function(u){c("Bootloader").loadModules(["KeyframesEnvironment"],function(v){return u(v)},"Keyframes")})})}function m(){return i.then(function(){return new(c("Promise"))(function(u){c("Bootloader").loadModules(["KeyframesAssetDecoder"],function(v){return u(v)},"Keyframes")})})}function n(){return l().then(function(u){return u.whenRenderLoopHasBeenStableOnce()})}function o(u){if(!u||typeof u!=="string")return c("Promise").reject("Request: invalid uri "+u);return i.then(function(){return new(c("Promise"))(function(v,w){new(c("XHRRequest"))(u).setMethod("GET").setResponseType("arraybuffer").setErrorHandler(function(x){return w(x)}).setAbortHandler(function(x){return w(x)}).setResponseHandler(function(x){return v(x)}).send()})})}function p(u){return h[u]!=null}function q(u){if(h[u]==null)h[u]=new s(u);return h[u]}function r(u){this.$SessionStub1={start:Date.now(),utilized:false};this.$SessionStub3=k().then(function(v){var w=new v("network",u,this.$SessionStub1.start);this.$SessionStub4(w);return w}.bind(this));this.$SessionStub3.done(function(v){return this.$SessionStub2=v}.bind(this))}r.prototype.getSession=function(){return this.$SessionStub3};r.prototype.$SessionStub4=function(u){if(this.$SessionStub1.assetRequest!=null){var v=u.startAssetRequest(this.$SessionStub1.assetRequest);if(this.$SessionStub1.assetRequestError!=null){v.error(this.$SessionStub1.assetRequestError);return}if(this.$SessionStub1.assetResponse!=null)v.loadedFromNetwork(this.$SessionStub1.assetResponse)}if(this.$SessionStub1.assetDecode!=null){var w=u.startAssetDecode(this.$SessionStub1.assetDecode);if(this.$SessionStub1.assetDecodeError!=null){w.error(this.$SessionStub1.assetDecodeError);return}if(this.$SessionStub1.finish!=null)w.finish(this.$SessionStub1.finish)}if(this.$SessionStub1.utilized)u.utilizeAsset()};r.prototype.startAssetDecode=function(){if(this.$SessionStub2)return this.$SessionStub2.startAssetDecode();else{this.$SessionStub1.assetDecode=Date.now();return{finish:function(){if(this.$SessionStub2)this.$SessionStub2.startAssetDecode(this.$SessionStub1.assetDecode).finish(Date.now());else this.$SessionStub1.finish=Date.now()}.bind(this),error:function(){if(this.$SessionStub2)this.$SessionStub2.startAssetDecode(this.$SessionStub1.assetDecode).error(Date.now());else this.$SessionStub1.assetDecodeError=Date.now()}.bind(this)}}};r.prototype.startAssetRequest=function(){if(this.$SessionStub2)return this.$SessionStub2.startAssetRequest();else{this.$SessionStub1.assetRequest=Date.now();var u=function(){if(this.$SessionStub2)return this.$SessionStub2.startAssetRequest(this.$SessionStub1.assetRequest).loadedFromNetwork(Date.now());else{this.$SessionStub1.assetResponse=Date.now();return{startAssetDecode:this.startAssetDecode.bind(this)}}}.bind(this),v=function(){if(this.$SessionStub2)this.$SessionStub2.startAssetRequest(this.$SessionStub1.assetRequest).error(Date.now());else this.$SessionStub1.assetRequestError=Date.now()}.bind(this);return{loadedFromCache:u,loadedFromNetwork:u,cancel:v,error:v}}};r.prototype.utilizeAsset=function(){if(this.$SessionStub2)this.$SessionStub2.utilizeAsset();else this.$SessionStub1.utilized=true};function s(u){this.$DecodedAssetRequest1=[];this.$DecodedAssetRequest3=[];this.$DecodedAssetRequest4=[];this.$DecodedAssetRequest5="requesting";this.$DecodedAssetRequest7=false;this.$DecodedAssetRequest6=u}s.prototype.isLoaded=function(){return this.$DecodedAssetRequest5==="done"};s.prototype.requestAsset=function(u){return this.$DecodedAssetRequest8(new r(u))};s.prototype.requestRenderer=function(u){var v=new r(u);return c("Promise").all([this.$DecodedAssetRequest8(v),v.getSession(),j(),n()]).then(function(w){var x=w[0],y=w[1],z=w[2];this.$DecodedAssetRequest9();return new z(x,y.getPerformanceLogIfEnabled())}.bind(this))};s.prototype.$DecodedAssetRequest9=function(){if(!this.$DecodedAssetRequest7){this.$DecodedAssetRequest4.forEach(function(u){return u.utilizeAsset()});this.$DecodedAssetRequest7=true}};s.prototype.$DecodedAssetRequest8=function(u){this.$DecodedAssetRequest4.push(u);if(this.$DecodedAssetRequest7)u.utilizeAsset();switch(this.$DecodedAssetRequest5){case"requesting":this.$DecodedAssetRequest3.push(u.startAssetRequest());break;case"decoding":this.$DecodedAssetRequest1.push(u.startAssetDecode());break}if(!this.$DecodedAssetRequest2)this.$DecodedAssetRequest2=c("Promise").all([o(this.$DecodedAssetRequest6),m()]).then(function(v){var w=v[0],x=v[1];this.$DecodedAssetRequest5="decoding";while(this.$DecodedAssetRequest3.length)this.$DecodedAssetRequest1.push(this.$DecodedAssetRequest3.pop().loadedFromNetwork().startAssetDecode());return x.fromBytes(w)}.bind(this),function(v){this.$DecodedAssetRequest3.forEach(function(w){return w.error()});return this.$DecodedAssetRequest10(v)}.bind(this)).then(function(v){this.$DecodedAssetRequest5="done";this.$DecodedAssetRequest1.forEach(function(w){return w.finish()});this.$DecodedAssetRequest11();return v}.bind(this),function(v){this.$DecodedAssetRequest1.forEach(function(w){return w.error()});return this.$DecodedAssetRequest10(v)}.bind(this));return this.$DecodedAssetRequest2};s.prototype.$DecodedAssetRequest10=function(u){this.$DecodedAssetRequest11();this.$DecodedAssetRequest5="error";return c("Promise").reject(u)};s.prototype.$DecodedAssetRequest11=function(){this.$DecodedAssetRequest3.length=0;this.$DecodedAssetRequest1.length=0};var t={requestDecodedAssetOnly:function u(v,w){return q(v).requestAsset(w)},requestRenderer:function u(v,w){return q(v).requestRenderer(w)},hasLoaded:function u(v){return p(v)&&q(v).isLoaded()},clearCache:function u(){h={}}};f.exports=t}),null);